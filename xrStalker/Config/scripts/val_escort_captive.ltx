[logic@val_escort_captive]
active = walker@val_escort_captive_wait
on_death = death@val_escort_captive
combat_ignore = combat_ignore

[death@val_escort_captive]
on_info  = %+val_escort_captive_dead%
on_info2 = {+val_escort_nap1_dead} %+val_escort_scene_end%

;--------------------------------------------------------------------------
; встреча отключена
;--------------------------------------------------------------------------
[meet@val_escort_captive_ignore]
meet_state     = 1|wait
meet_state_wpn = 1|guard
victim         = 1|actor
victim_wpn     = 1|actor
use            = false
use_wpn        = false

;--------------------------------------------------------------------------
; стандартный диалог
;--------------------------------------------------------------------------
[meet@val_escort_captive_def]
meet_state = 3|wait
meet_state_wpn = 3|wait
victim = 30|actor
victim_wpn = 20|actor
use = true
use_wpn = true

;--------------------------------------------------------------------------
; стандартный диалог
;--------------------------------------------------------------------------
[meet@val_escort_captive_talk]
meet_dialog     = val_escort_captive_dialog
meet_state      = 3|wait
meet_state_wpn  = 3|wait
victim = 30|actor
victim_wpn = 20|actor
use = true
use_wpn = true

[wounded@val_escort_captive]
hp_state = 10|wounded_heavy@help_heavy
hp_state_see = 10|wounded_heavy@help_heavy
hp_victim = 0|nil
hp_fight = 0|false
hp_cover = 0|false

;--------------------------------------------------------------------------
; 
;--------------------------------------------------------------------------
[walker@val_escort_captive_wait]
path_walk           = captive_wait_walk
path_look           = captive_wait_look
on_info             = {+val_escort_start} patrol@val_escort_captive_go
combat_ignore_cond  = always

;--------------------------------------------------------------------------
; 
;--------------------------------------------------------------------------
[patrol@val_escort_captive_go]
path_walk           = captive_walk
path_look           = captive_look
formation           = back
commander           = true
on_signal           = fight | walker@val_escort_captive_hide %+val_escort_combat -val_escort_wait%
on_signal2          = move_end | %+val_escort_scene_fail%
on_info             = {+val_escort_combat} walker@val_escort_captive_cover
on_info2            = {+val_escort_guard1_combat} remark@val_escort_captive_hide, {+val_escort_guard2_combat} remark@val_escort_captive_hide
meet                = meet@val_escort_captive_ignore
combat_ignore_cond  = always
wounded             = wounded@val_escort_captive

;--------------------------------------------------------------------------
; 
;--------------------------------------------------------------------------
[remark@val_escort_captive_hide]
no_move             = true
no_rotate           = true
anim                = hide
on_info             = {+val_escort_combat} walker@val_escort_captive_cover
on_info2            = {-val_escort_guard1_combat -val_escort_guard2_combat} walker@val_escort_captive_go
meet                = meet@val_escort_captive_ignore
combat_ignore_cond  = always
wounded             = wounded@val_escort_captive

;--------------------------------------------------------------------------
; 
;--------------------------------------------------------------------------
[walker@val_escort_captive_cover]
path_walk           = captive_hide_walk
path_look           = captive_hide_look
def_state_moving1   = sprint
def_state_moving2   = sprint
def_state_moving3   = sprint
meet                = meet@val_escort_captive_ignore
on_info             = {+val_escort_guard1_dead +val_escort_guard2_dead} follower@val_escort_captive_go_to_nap1
combat_ignore_cond  = always
wounded             = wounded@val_escort_captive

;--------------------------------------------------------------------------
; 
;--------------------------------------------------------------------------
[follower@val_escort_captive_go_to_nap1]
leader              = 406
meet                = meet@val_escort_captive_ignore
distance            = 2
stub_for_corpse     = true
on_signal           = leader_dead | remark@val_escort_captive_check_state
on_info             = {=distance_to_obj_le(406:3)} remark@val_escort_captive_check_state
;combat_ignore_cond  = always
wounded             = wounded@val_escort_captive

;--------------------------------------------------------------------------
[remark@val_escort_captive_check_state]
no_move             = true
;no_rotate           = true
target              = 406
anim                = wait
meet                = meet@val_escort_captive_ignore
on_info             = {-val_escort_nap1_dead} remark1@val_escort_captive_phrase1, remark1@val_escort_captive_phrase2
;combat_ignore_cond  = always
wounded             = wounded@val_escort_captive

;--------------------------------------------------------------------------
; фраза: Черт подери!!!...Эх-ххх...Пусть земля тебе будет пухом, дружище.
;--------------------------------------------------------------------------
[remark1@val_escort_captive_phrase2]
no_move             = true
no_rotate           = true
;target              = 406
anim                = wait
snd                 = val_escort_dead
meet                = meet@val_escort_captive_ignore
on_signal           = sound_end | {+val_escort_actor_helped} remark@val_escort_captive_talk, patrol@val_escort_captive_leave
on_timer            = 20000 | {+val_escort_actor_helped} remark@val_escort_captive_talk, patrol@val_escort_captive_leave
;combat_ignore_cond  = always
wounded             = wounded@val_escort_captive

;--------------------------------------------------------------------------
; фраза: Пуля! Спасибо, друг. Я блин уже с жизнью попрощался!!
;--------------------------------------------------------------------------
[remark1@val_escort_captive_phrase1]
no_move             = true
;no_rotate           = true
target              = 406
anim                = wait
snd                 = val_escort_captive_phrase2
meet                = meet@val_escort_captive_ignore
on_signal           = sound_end | {+val_escort_actor_helped} remark1@val_escort_captive_wait1 %+val_escort_captive_phrase1_end%, remark1@val_escort_captive_wait2 %+val_escort_captive_phrase1_end%
;combat_ignore_cond  = always
wounded             = wounded@val_escort_captive

;--------------------------------------------------------------------------
; ждем когда nap1 скажет фразу: Это вот сталкера благодари. Он мне помог.
;--------------------------------------------------------------------------
[remark1@val_escort_captive_wait1]
no_move             = true
;no_rotate           = true
target              = 406
anim                = wait
meet                = meet@val_escort_captive_ignore
on_info             = {+val_escort_nap1_phrase1_end} remark1@val_escort_captive_phrase3
;combat_ignore_cond  = always
wounded             = wounded@val_escort_captive

;--------------------------------------------------------------------------
; фраза: Спасибо, чувак!
;--------------------------------------------------------------------------
[remark1@val_escort_captive_phrase3]
no_move             = true
;no_rotate           = true
anim                = wait
snd                 = val_escort_captive_phrase3
meet                = meet@val_escort_captive_ignore
on_signal           = sound_end | remark@val_escort_captive_talk
;combat_ignore_cond  = always
wounded             = wounded@val_escort_captive

;--------------------------------------------------------------------------
; фраза: Подходи пообщаемся.
;--------------------------------------------------------------------------
[remark@val_escort_captive_talk]
no_move                 = true
;no_rotate               = true
anim                    = wait
snd                     = val_escort_phrase_invite
meet                    = meet@val_escort_captive_talk
;on_timer               = 60000 | patrol@val_escort_captive_leave
on_actor_dist_ge_nvis   = 30 | patrol@val_escort_captive_leave
;combat_ignore_cond      = always
wounded                 = wounded@val_escort_captive

;--------------------------------------------------------------------------
; ждем когда nap1 скажет фразу: Жив-здоров? Тогда возвращаемся на Базу за подмогой.
;--------------------------------------------------------------------------
[remark1@val_escort_captive_wait2]
no_move             = true
;no_rotate           = true
target              = 406
anim                = wait
meet                = meet@val_escort_captive_ignore
on_info             = {+val_escort_nap1_phrase2_end} patrol@val_escort_captive_leave
;combat_ignore_cond  = always
wounded             = wounded@val_escort_captive

;--------------------------------------------------------------------------
; уходим с уровня
;--------------------------------------------------------------------------
[patrol@val_escort_captive_leave]
path_walk           = leave_walk
path_look           = leave_look
formation           = line
;meet               = meet@val_escort_captive_ignore
;combat_ignore_cond = always
on_signal           = arrived | %+val_escort_captive_offline +val_escort_scene_end%
