[logic]
active        = remark1@begin ;walker@wait
;on_combat     = combat
on_hit        = hit
on_death      = death
combat_ignore = combat_ignore

[dont_spawn_character_supplies]

[spawn]
wpn_ak47u
ammo_5.45x39_ap=2

;[combat]
;on_info = {=hitted_by(407:408)} remark@fight %+val_escort_combat%

[death]
on_info = %+val_escort_nap1_dead%

[hit]
on_info = {=hitted_by(407:408)} %+val_escort_combat%

[combat_ignore]

;--------------------------------------------------------------------------
; встреча отключена
;--------------------------------------------------------------------------
[meet@ignore]
meet_state     = 1|wait
meet_state_wpn = 1|guard
victim         = 1|actor
victim_wpn     = 1|actor
use            = false
use_wpn        = false

;--------------------------------------------------------------------------
; стандартная встреча
;--------------------------------------------------------------------------
[meet@def]
meet_state     = 30|hello|5|guard
meet_state_wpn = 15|guard
victim         = 15|actor
victim_wpn     = 15|actor
use            = false
use_wpn        = false

;--------------------------------------------------------------------------
; стандартная встреча без приветствия
;--------------------------------------------------------------------------
[meet@def_no_hello]
meet_state     = 30|guard
meet_state_wpn = 15|guard
victim         = 15|actor
victim_wpn     = 15|actor
use            = false
use_wpn        = false

;--------------------------------------------------------------------------
; основной диалог
;--------------------------------------------------------------------------
[meet@talk]
meet_dialog    = val_escort_nap1_dialog
meet_state     = 15|guard
meet_state_wpn = 15|threat@threat_weap
victim         = 15|actor
victim_wpn     = 15|actor
use            = true
use_wpn        = false


;--------------------------------------------------------------------------
; начало
;--------------------------------------------------------------------------
[remark1@begin]
no_move             = true
;no_rotate           = true
anim                = search
target              = 424
meet                = meet@ignore
on_info             = {+val_escort_begin} remark1@phrase1
combat_ignore_cond  = always

;--------------------------------------------------------------------------
; фразы: ...Рассказывай, иначе узнаешь, как легко пуля пробивает череп.
;        Не-еет!!! Не убивай меня! Твоего напарника, сейчас будут вести на Базу Монолита. Это все, что я знаю...бля-буду...
;        Ладно, мразь, живи. Но больше на глаза мне не попадайся.
;--------------------------------------------------------------------------
[remark1@phrase1]
no_move             = true
;no_rotate           = true
anim                = search
snd                 = val_escort_nap1_phrase1
target              = 424
meet                = meet@ignore
on_info             = {=is_dead_one(424)} remark1@phrase3
on_signal           = sound_end | remark1@phrase3
combat_ignore_cond  = always

;--------------------------------------------------------------------------
; фраза: Эй, дружище, ПОДХОДИ!!!...помоги отбить напарника у бандитской швали!
;--------------------------------------------------------------------------
[remark1@phrase3]
no_move             = true
;no_rotate           = true
anim                = guard
meet                = meet@def
snd                 = val_escort_nap1_phrase1
on_signal           = sound_end | remark1@wait1
combat_ignore_cond  = always

;--------------------------------------------------------------------------
; ждем 5 сек
;--------------------------------------------------------------------------
[remark1@wait1]
no_move             = true
;no_rotate           = true
anim                = guard
meet                = meet@def_no_hello
on_actor_dist_le    = 5 | remark1@phrase6
on_timer            = 5000 | remark1@phrase4
combat_ignore_cond  = always

;--------------------------------------------------------------------------
; фраза: Скорей же!... время не ждет!..
;--------------------------------------------------------------------------
[remark1@phrase4]
no_move             = true
;no_rotate           = true
anim                = guard
meet                = meet@def_no_hello
snd                 = val_escort_nap1_phrase2
on_signal           = sound_end | remark1@wait2
combat_ignore_cond  = always

;--------------------------------------------------------------------------
; ждем 5 сек
;--------------------------------------------------------------------------
[remark1@wait2]
no_move             = true
;no_rotate           = true
anim                = guard
meet                = meet@def_no_hello
on_actor_dist_le    = 5 | remark1@phrase6
on_timer            = 5000 | remark1@phrase5
combat_ignore_cond  = always

;--------------------------------------------------------------------------
; фраза: Блин...Ну, как хочешь.
;--------------------------------------------------------------------------
[remark1@phrase5]
no_move             = true
;no_rotate           = true
anim                = guard
meet                = meet@def_no_hello
snd                 = val_escort_nap1_phrase2
on_signal           = sound_end | walker1@ambush_go %+val_escort_start%
combat_ignore_cond  = always

;--------------------------------------------------------------------------
; фраза: Давай за мной, я знаю место для засады! Поможешь - буду благодарен. Долги в "Долге" возвращают:)!.
;--------------------------------------------------------------------------
[remark1@phrase6]
no_move             = true
;no_rotate           = true
anim                = guard
meet                = meet@def_no_hello
snd                 = val_escort_nap1_phrase3
on_signal           = sound_end | walker1@ambush_go %+val_escort_start%
combat_ignore_cond  = always

;--------------------------------------------------------------------------
; задание принято. идем к месту засады
;--------------------------------------------------------------------------
[walker1@ambush_go]
path_walk           = val_escort_nap1_rescue_walk
path_look           = val_escort_nap1_rescue_look
def_state_moving1   = rush
meet                = meet@ignore
on_signal           = ambush_start | remark1@wait_for_actor
on_info             = {+val_escort_combat} remark1@fight
combat_ignore_cond  = always ;{=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; Ждем, чтоб актер подошел поближе
;--------------------------------------------------------------------------
[remark1@wait_for_actor]
no_move                 = true
no_rotate               = true
anim                    = hide
meet                    = meet@ignore
on_info                 = {+val_escort_combat} remark1@fight
on_actor_dist_le_nvis   = 4 | remark1@phrase7
combat_ignore_cond      = {=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; фраза: Прячься за укрытием на той стороне дороги. Они скоро появятся. Открывай огонь ТОЛЬКО после меня.
;--------------------------------------------------------------------------
[remark1@phrase7]
no_move             = true
no_rotate           = true
anim                = hide
snd                 = val_escort_nap1_phrase4
on_timer            = 40000 | remark1@phrase8
on_info             = {+val_escort_combat} remark1@fight
combat_ignore_cond  = {=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; фраза: Идут. Сейчас мы их.
;--------------------------------------------------------------------------
[remark1@phrase8]
no_move             = true
no_rotate           = true
anim                = hide
snd                 = val_escort_nap1_phrase4
;meet               = meet@ignore
on_info             = {+val_escort_combat} remark1@fight
combat_ignore_cond  = {=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; бой с гвардами
;--------------------------------------------------------------------------
[remark1@fight]
meet    = meet@ignore
on_info = {+val_escort_guard1_dead +val_escort_guard2_dead} remark1@task_done

;--------------------------------------------------------------------------
; гварды убиты
;--------------------------------------------------------------------------
[remark1@task_done]
no_move   = true
no_rotate = true
anim      = guard
meet      = meet@def
on_info   = {-val_escort_captive_dead} remark1@captive_live, follower1@captive_dead

;--------------------------------------------------------------------------
; заложник жив. проверяем помог ли актер
;--------------------------------------------------------------------------
[remark1@captive_live]
no_move   = true
no_rotate = true
anim      = guard
meet      = meet@def
on_info   = {+val_escort_actor_helped} remark1@captive_live_helped, remark1@captive_live_not_helped

;--------------------------------------------------------------------------
; актер помог. ждем пока подойдет заложник и поблагодарит напарника
;--------------------------------------------------------------------------
[remark1@captive_live_helped]
no_move   = true
;no_rotate = true
target    = 400
anim      = guard
meet      = meet@def
on_info   = {+val_escort_captive_phrase1_end} remark1@phrase9

;--------------------------------------------------------------------------
; фраза: Это вот сталкера благодари. Он мне помог.
;--------------------------------------------------------------------------
[remark1@phrase9]
no_move    = true
;no_rotate = true
target    = 400
anim       = guard
snd        = val_escort_nap1_phrase3
meet       = meet@ignore
on_signal  = sound_end | remark1@wait_to_talk %+val_escort_nap1_phrase1_end%

;--------------------------------------------------------------------------
; актер не помог. ждем пока подойдет заложник и поблагодарит напарника
;--------------------------------------------------------------------------
[remark1@captive_live_not_helped]
no_move   = true
;no_rotate = true
target    = 400
anim      = guard
meet      = meet@def
on_info   = {+val_escort_captive_phrase1_end} remark1@phrase11

;--------------------------------------------------------------------------
; фраза: Жив-здоров? Тогда возвращаемся на Базу за подмогой.
;--------------------------------------------------------------------------
[remark1@phrase11]
no_move         = true
;no_rotate       = true
target          = 400
anim            = wait
snd             = val_escort_nap1_go_home
meet            = meet@ignore
on_signal       = sound_end | walker1@leave %+val_escort_nap1_phrase2_end%

;--------------------------------------------------------------------------
; заложник мертв. подходим к нему
;--------------------------------------------------------------------------
[follower1@captive_dead]
leader          = 400
stub_for_corpse = true
distance        = 0.5
anim            = guard
meet            = meet@def
on_signal       = leader_dead | remark1@phrase10

;--------------------------------------------------------------------------
; фраза: Черт подери!!!...Эх-ххх...Пусть земля тебе будет пухом, дружище.
;--------------------------------------------------------------------------
[remark1@phrase10]
no_move         = true
;no_rotate       = true
target          = 400
anim            = wait
snd             = val_escort_dead
meet            = meet@ignore
on_signal       = sound_end | {+val_escort_actor_helped} remark1@wait_to_talk_phrase, walker1@leave

;--------------------------------------------------------------------------
; фраза: Подходи пообщаемся.
;--------------------------------------------------------------------------
[remark1@wait_to_talk_phrase]
no_move         = true
;no_rotate       = true
snd             = val_escort_phrase_invite
meet            = meet@talk
on_timer        = 60000 | walker1@leave ; ждем минуту и уходим

;--------------------------------------------------------------------------
; ждем диалога
;--------------------------------------------------------------------------
[remark1@wait_to_talk]
no_move         = true
;no_rotate       = true
meet            = meet@talk
on_timer        = 60000 | walker1@leave ; ждем минуту и уходим

;--------------------------------------------------------------------------
; уходим с уровня
;--------------------------------------------------------------------------
[walker1@leave]
path_walk   = val_escort_nap1_leave_walk
path_look   = val_escort_nap1_leave_look
meet        = meet@talk
on_signal   = arrived | nil

;--- OLD

;--------------------------------------------------------------------------
; ждем пока игрок не подойдет на дистанцию, тогда проговариваем фразу
;--------------------------------------------------------------------------
[walker@wait]
path_walk        = val_escort_nap1_walk
path_look        = val_escort_nap1_look
meet             = meet@def
on_info          = {+val_sacrifice_spawn} walker@fake_task, {+val_sacrifice_not_spawn} walker@fake_task
on_actor_dist_le = 10 | remark@phrase1

;--------------------------------------------------------------------------
; фраза: Друг, подходи, есть дело.
;--------------------------------------------------------------------------
[remark@phrase1]
no_move   = true
no_rotate = true
anim      = hello
snd       = speech
on_signal = sound_end | walker@talk
on_info   = {+val_sacrifice_spawn} walker@fake_task, {+val_sacrifice_not_spawn} walker@fake_task

;--------------------------------------------------------------------------
; ждем диалога с игроком.
;--------------------------------------------------------------------------
[walker@talk]
path_walk = val_escort_nap1_walk
path_look = val_escort_nap1_look
meet      = meet@talk
;on_info   = {+val_sacrifice_spawn} walker@fake_task, {+val_sacrifice_not_spawn} walker@fake_task
;on_info2  = {+val_escort_nap1_go_rescue} walker@ambush_go %+val_escort_start%
on_timer  = 15000 | walker@ambush_go ;%+val_escort_start%

;--------------------------------------------------------------------------
; задание принято. идем к месту засады
;--------------------------------------------------------------------------
[walker@ambush_go]
path_walk           = val_escort_nap1_rescue_walk
path_look           = val_escort_nap1_rescue_look
;radius              = 1
def_state_moving1   = rush
;def_state_campering = hide
;no_retreat          = true
meet                = meet@ignore
on_signal           = ambush_start | remark@phrase2 ;walker@wait_for_actor
on_info             = {+val_escort_combat} remark@fight
combat_ignore_cond  = always ;{=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; Ждем, чтоб актер подошел поближе
;--------------------------------------------------------------------------
[walker@wait_for_actor]
path_walk               = val_escort_nap1_rescue_walk
path_look               = val_escort_nap1_rescue_look
;radius                  = 2
def_state_moving1       = rush
;def_state_campering     = hide
;no_retreat              = true
meet                    = meet@ignore
on_info                 = {+val_escort_combat} remark@fight
on_actor_dist_le_nvis   = 3 | remark@phrase2
combat_ignore_cond      = {=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; фраза: Прячься за укрытием на той стороне дороги. Они скоро появятся. Открывай огонь ТОЛЬКО после меня.
;--------------------------------------------------------------------------
[remark@phrase2]
no_move             = true
no_rotate           = true
anim                = hide
snd                 = speech
on_timer            = 40000 | remark@phrase3
on_info             = {+val_escort_captive_dead} walker@fake_task
combat_ignore_cond  = {=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; фраза: Идут. Сейчас мы их.
;--------------------------------------------------------------------------
[remark@phrase3]
no_move             = true
no_rotate           = true
anim                = hide
snd                 = speech
;meet               = meet@ignore
on_signal           = sound_end | walker@ambush_wait
on_info             = {+val_escort_captive_dead} remark@fake_wait
combat_ignore_cond  = {=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; ожидание в засаде
;--------------------------------------------------------------------------
[walker@ambush_wait]
path_walk           = val_escort_nap1_rescue_walk
path_look           = val_escort_nap1_rescue_look
;radius              = 3
def_state_moving1   = sneak
;def_state_campering = hide
;no_retreat          = true
meet                = meet@ignore
;on_signal           = escort_start | %+val_escort_start%
on_info             = {+val_escort_combat} remark@fight
combat_ignore_cond  = {=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; бой с гвардами
;--------------------------------------------------------------------------
[remark@fight]
on_info = {+val_escort_guard1_dead +val_escort_guard2_dead} walker@task_done

;--------------------------------------------------------------------------
; гварды убиты
;--------------------------------------------------------------------------
[walker@task_done]
path_walk   = val_escort_nap1_done_walk
path_look   = val_escort_nap1_done_look
meet        = meet@talk
;on_info    = {+val_escort_nap1_join} follower1
on_timer    = 60000 | walker@leave1

;--------------------------------------------------------------------------
; игрок не принял задание. фейковая засада
;--------------------------------------------------------------------------
[walker@fake_task]
path_walk   = val_escort_nap1_rescue_walk
path_look   = val_escort_nap1_rescue_look
meet        = meet@def
on_signal   = ambush_start | remark@fake_wait

;--------------------------------------------------------------------------
[remark@fake_wait]
;snd            = 'Where are they?'
;snd_timeout    = 3000
meet            = meet@def
on_timer        = 20000 | walker@leave2

;--------------------------------------------------------------------------
; уходим с уровня
;--------------------------------------------------------------------------
[walker@leave1]
path_walk   = val_escort_nap1_leave_walk
path_look   = val_escort_nap1_leave_look
meet        = meet@talk
on_signal   = arrived | nil

;--------------------------------------------------------------------------
; уходим с уровня
;--------------------------------------------------------------------------
[walker@leave2]
path_walk   = val_escort_nap1_leave_walk
path_look   = val_escort_nap1_leave_look
meet        = meet@def
on_signal   = arrived | nil
