[logic]
active = walker@wait
on_combat = combat
on_hit = hit
on_death = death
combat_ignore = combat_ignore

[combat]
on_info = {=hitted_by(407:408)} remark@fight %+val_escort_combat%

[death]
on_info = %+val_escort_nap1_dead%

[hit]
on_info = {=hitted_by(407:408)} %+val_escort_combat%

[combat_ignore]

;--------------------------------------------------------------------------
; стандартный диалог
;--------------------------------------------------------------------------
[meet@def]
meet_dialog = val_escort_nap1_dialog
meet_state = 15|hello@talk_hello|10|wait@|5|wait_na@
meet_state_wpn = 10|threat@threat_weap
victim = 30|actor
victim_vpn = 20|actor
use = true

;--------------------------------------------------------------------------
; ждем пока игрок не подойдет на дистанцию, тогда проговариваем фразу
;--------------------------------------------------------------------------
[walker@wait]
path_walk = val_escort_nap1_walk
path_look = val_escort_nap1_look
on_info = {+val_sacrifice_spawn} walker@fake_task, {+val_sacrifice_not_spawn} walker@fake_task
on_actor_dist_le = 10 | remark@phrase1

;--------------------------------------------------------------------------
; фраза: Друг, подходи, есть дело.
;--------------------------------------------------------------------------
[remark@phrase1]
no_move = true
no_rotate = true
anim = guard
snd = speech
on_signal = sound_end | walker@talk
on_info = {+val_sacrifice_spawn} walker@fake_task, {+val_sacrifice_not_spawn} walker@fake_task

;--------------------------------------------------------------------------
; ждем диалога с игроком.
;--------------------------------------------------------------------------
[walker@talk]
path_walk = val_escort_nap1_walk
path_look = val_escort_nap1_look
meet = meet@def
on_info = {+val_sacrifice_spawn} walker@fake_task, {+val_sacrifice_not_spawn} walker@fake_task
on_info2 = {+val_escort_nap1_go_rescue} camper@ambush_go %+val_escort_start%

;--------------------------------------------------------------------------
; задание принято. идем к месту засады
;--------------------------------------------------------------------------
[camper@ambush_go]
path_walk = val_escort_nap1_rescue_walk
path_look = val_escort_nap1_rescue_look
radius = 2
def_state_moving = rush
no_retreat = true
on_signal = ambush_start | remark@phrase2 ;camper@wait_for_actor
on_info = {+val_escort_combat} remark@fight
combat_ignore_cond = {=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; Ждем, чтоб актер подошел поближе
;--------------------------------------------------------------------------
[camper@wait_for_actor]
path_walk = val_escort_nap1_rescue_walk
path_look = val_escort_nap1_rescue_look
radius = 2
def_state_moving = rush
no_retreat = true
on_info = {+val_escort_combat} remark@fight
on_actor_dist_le_nvis = 3 | remark@phrase2
combat_ignore_cond = {=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; фраза: Прячься за укрытием на той стороне дороги. Они скоро появятся. Открывай огонь ТОЛЬКО после меня.
;--------------------------------------------------------------------------
[remark@phrase2]
no_move = true
no_rotate = true
anim = hide
snd = speech
on_timer = 40000 | remark@phrase3
on_info = {+val_escort_captive_dead} walker@fake_task
combat_ignore_cond = {=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; фраза: Идут. Сейчас мы их.
;--------------------------------------------------------------------------
[remark@phrase3]
no_move = true
no_rotate = true
anim = hide
snd = speech
on_signal = sound_end | camper@ambush_wait
on_info = {+val_escort_captive_dead} remark@fake_wait
combat_ignore_cond = {=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; задание принято. ожидание в засаде
;--------------------------------------------------------------------------
[camper@ambush_wait]
path_walk = val_escort_nap1_rescue_walk
path_look = val_escort_nap1_rescue_look
radius = 3
def_state_moving = rush
no_retreat = true
on_signal = escort_start | %+val_escort_start%
on_info = {+val_escort_nap1_phrase3} remark@phrase3, {+val_escort_combat} remark@fight
combat_ignore_cond = {=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; бой с гвардами
;--------------------------------------------------------------------------
[remark@fight]
on_info = {+val_escort_guard1_dead +val_escort_guard2_dead} walker@task_done

;--------------------------------------------------------------------------
; гварды убиты
;--------------------------------------------------------------------------
[walker@task_done]
path_walk = val_escort_nap1_done_walk
path_look = val_escort_nap1_done_look
meet = meet@def
; берем напарником
;on_info = {+val_escort_nap1_join} follower1
on_timer = 60000 | walker@leave

;--------------------------------------------------------------------------
; игрок не принял задание. фейковая засада
;--------------------------------------------------------------------------
[walker@fake_task]
path_walk = val_escort_nap1_rescue_walk
path_look = val_escort_nap1_rescue_look
on_signal = ambush_start | remark@fake_wait

;--------------------------------------------------------------------------
[remark@fake_wait]
;snd = 'Where are they?'
;snd_timeout = 3000
on_timer = 20000 | walker@leave

;--------------------------------------------------------------------------
; уходим с уровня
[walker@leave]
path_walk = val_escort_nap1_leave_walk
path_look = val_escort_nap1_leave_look
meet = meet@def
on_signal = arrived | nil
