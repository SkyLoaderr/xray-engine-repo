[logic@val_escort_nap1]
active        = walker@val_escort_nap1_begin
;on_combat     = combat@val_escort_nap1
on_hit        = hit@val_escort_nap1
on_death      = death@val_escort_nap1
combat_ignore = combat_ignore

;[combat@val_escort_nap1]
;on_info = {=hitted_by(407:408)} remark@fight %+val_escort_combat%

[death@val_escort_nap1]
on_info  = %+val_escort_nap1_dead%
on_info2 = {+val_escort_captive_dead} %+val_escort_scene_end%

[hit@val_escort_nap1]
on_info = {=hitted_by(407:408)} %+val_escort_combat%
;on_info2 = {=hit_by_actor} nil %+val_escort_nap1_dead%

;--------------------------------------------------------------------------
; встреча отключена
;--------------------------------------------------------------------------
[meet@val_escort_nap1_ignore]
meet_state     = 1|wait
meet_state_wpn = 1|guard
victim         = 1|actor
victim_wpn     = 1|actor
use            = false
use_wpn        = false

;--------------------------------------------------------------------------
; стандартная встреча
;--------------------------------------------------------------------------
[meet@val_escort_nap1_def]
meet_state     = 30|hello|5|guard
meet_state_wpn = 15|guard
victim         = 15|actor
victim_wpn     = 15|actor
use            = false
use_wpn        = false

;--------------------------------------------------------------------------
; стандартная встреча без приветствия
;--------------------------------------------------------------------------
[meet@val_escort_nap1_def_no_hello]
meet_state     = 30|guard
meet_state_wpn = 15|guard
victim         = 15|actor
victim_wpn     = 15|actor
use            = false
use_wpn        = false

;--------------------------------------------------------------------------
; основной диалог
;--------------------------------------------------------------------------
[meet@val_escort_nap1_talk]
meet_dialog    = val_escort_nap1_dialog
meet_state     = 15|guard
meet_state_wpn = 15|guard
victim         = 15|actor
victim_wpn     = 15|actor
use            = true
use_wpn        = true

[danger@val_escort_nap1_1]
ignore_distance_sound     = 10
ignore_distance_corpse    = 1

[danger@val_escort_nap1_small]
ignore_distance_sound     = 5
ignore_distance_corpse    = 1

[wounded@val_escort_nap1]
hp_state        = 10|wounded_heavy@help_heavy
hp_state_see    = 10|wounded_heavy@help_heavy
hp_victim       = 0|nil
hp_fight        = 0|false
hp_cover        = 0|false

;--------------------------------------------------------------------------
; начало
;--------------------------------------------------------------------------
[walker@val_escort_nap1_begin]
path_walk           = nap1_walk
path_look           = nap1_look
meet                = meet@val_escort_nap1_ignore
on_info             = {+val_escort_begin} remark1@val_escort_nap1_phrase1
danger              = danger@val_escort_nap1_small
wounded             = wounded@val_escort_nap1
combat_ignore_cond  = always ;{=check_fighting(424)}

;--------------------------------------------------------------------------
; фразы: ...Рассказывай, иначе узнаешь, как легко пуля пробивает череп.
;        Не-еет!!! Не убивай меня! Твоего напарника, сейчас будут вести на Базу Монолита. Это все, что я знаю...бля-буду...
;        Ладно, мразь, живи. Но больше на глаза мне не попадайся.
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_phrase1]
no_move             = true
;no_rotate           = true
anim                = search
snd                 = val_escort_nap1_phrase1
target              = 424
meet                = meet@val_escort_nap1_ignore
on_info             = {=is_dead_one(424)} remark1@val_escort_nap1_phrase3 %+val_nap1_stop_talk_to_bandit%
on_signal           = sound_end | remark1@val_escort_nap1_phrase3 %+val_nap1_stop_talk_to_bandit%
danger              = danger@val_escort_nap1_small
wounded             = wounded@val_escort_nap1
combat_ignore_cond  = always ;{=check_fighting(424)}

;--------------------------------------------------------------------------
; фраза: Эй, дружище, ПОДХОДИ!!!...помоги отбить напарника у бандитской швали!
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_phrase3]
no_move             = true
;no_rotate           = true
anim                = guard
meet                = meet@val_escort_nap1_ignore
snd                 = val_escort_nap1_phrase1
on_signal           = sound_end | remark1@val_escort_nap1_wait1
danger              = danger@val_escort_nap1_small
wounded             = wounded@val_escort_nap1
combat_ignore_cond  = always ;{=check_fighting(424)}

;--------------------------------------------------------------------------
; ждем 5 сек
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_wait1]
no_move             = true
;no_rotate           = true
anim                = guard
meet                = meet@val_escort_nap1_ignore
on_actor_dist_le    = 2 | remark1@val_escort_nap1_phrase6
on_timer            = 5000 | remark1@val_escort_nap1_phrase4
danger              = danger@val_escort_nap1_small
wounded             = wounded@val_escort_nap1
combat_ignore_cond  = always ;{=check_fighting(424)}

;--------------------------------------------------------------------------
; фраза: Скорей же!... время не ждет!..
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_phrase4]
no_move             = true
;no_rotate           = true
anim                = guard
meet                = meet@val_escort_nap1_ignore
snd                 = val_escort_nap1_phrase2
on_signal           = sound_end | remark1@val_escort_nap1_wait2
danger              = danger@val_escort_nap1_small
wounded             = wounded@val_escort_nap1
combat_ignore_cond  = always ;{=check_fighting(424)}

;--------------------------------------------------------------------------
; ждем 5 сек
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_wait2]
no_move             = true
;no_rotate           = true
anim                = guard
meet                = meet@val_escort_nap1_ignore
on_actor_dist_le    = 2 | remark1@val_escort_nap1_phrase6
on_timer            = 5000 | remark1@val_escort_nap1_phrase5
danger              = danger@val_escort_nap1_small
wounded             = wounded@val_escort_nap1
combat_ignore_cond  = always ;{=check_fighting(424)}

;--------------------------------------------------------------------------
; фраза: Блин...Ну, как хочешь.
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_phrase5]
no_move             = true
;no_rotate           = true
anim                = guard
meet                = meet@val_escort_nap1_ignore
snd                 = val_escort_nap1_phrase2
on_signal           = sound_end | walker1@val_escort_nap1_ambush_go %+val_escort_start%
danger              = danger@val_escort_nap1_small
wounded             = wounded@val_escort_nap1
combat_ignore_cond  = always ;{=check_fighting(424)}

;--------------------------------------------------------------------------
; фраза: Давай за мной, я знаю место для засады! Поможешь - буду благодарен. Долги в "Долге" возвращают:)!.
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_phrase6]
no_move             = true
;no_rotate           = true
anim                = guard
meet                = meet@val_escort_nap1_ignore
snd                 = val_escort_nap1_phrase3
on_signal           = sound_end | walker1@val_escort_nap1_ambush_go %+val_escort_start%
danger              = danger@val_escort_nap1_small
wounded             = wounded@val_escort_nap1
combat_ignore_cond  = always ;{=check_fighting(424)}

;--------------------------------------------------------------------------
; задание принято. идем к месту засады
;--------------------------------------------------------------------------
[walker1@val_escort_nap1_ambush_go]
path_walk           = nap1_rescue_walk
path_look           = nap1_rescue_look
def_state_moving1   = rush
def_state_moving2   = rush
def_state_moving3   = rush
meet                = meet@val_escort_nap1_ignore
on_signal           = ambush_start | remark1@val_escort_nap1_wait_for_actor
on_info             = {+val_escort_combat} remark1@val_escort_nap1_fight
danger              = danger@val_escort_nap1_small
wounded             = wounded@val_escort_nap1
combat_ignore_cond  = {=check_fighting(407:408) -val_escort_combat}, {=check_fighting(424)} ;always

;--------------------------------------------------------------------------
; Ждем, чтоб актер подошел поближе
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_wait_for_actor]
no_move                 = true
no_rotate               = true
anim                    = hide
meet                    = meet@val_escort_nap1_ignore
on_actor_dist_le_nvis   = 10 | remark1@val_escort_nap1_phrase7
on_info                 = {+val_escort_combat} remark1@val_escort_nap1_fight
on_info2                = {=distance_to_obj_le(400:30)} remark1@val_escort_nap1_phrase8
danger                  = danger@val_escort_nap1_small
wounded                 = wounded@val_escort_nap1
combat_ignore_cond      = {=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; фраза: Прячься за укрытием на той стороне дороги. Они скоро появятся. Открывай огонь ТОЛЬКО после меня.
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_phrase7]
no_move             = true
no_rotate           = true
anim                = hide
snd                 = val_escort_nap1_phrase4
on_timer            = 60000 | {+val_escort_scene_fail} remark@val_escort_nap1_fail
on_info             = {+val_escort_combat} remark1@val_escort_nap1_fight
on_info2            = {=distance_to_obj_le(400:30)} remark1@val_escort_nap1_phrase8
combat_ignore_cond  = {=check_fighting(407:408) -val_escort_combat}
danger              = danger@val_escort_nap1_small
wounded             = wounded@val_escort_nap1
combat_ignore_cond  = {=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; фраза: 
;--------------------------------------------------------------------------
[remark@val_escort_nap1_fail]
no_move             = true
no_rotate           = true
anim                = hide
snd                 = val_escort_nap1_fail
on_signal           = sound_end | patrol@val_escort_nap1_leave
danger              = danger@val_escort_nap1_small
wounded             = wounded@val_escort_nap1
combat_ignore_cond  = {=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; фраза: Идут. Сейчас мы их.
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_phrase8]
no_move             = true
no_rotate           = true
anim                = hide
snd                 = val_escort_nap1_phrase6
;meet               = meet@val_escort_nap1_ignore
on_info             = {+val_escort_combat} remark1@val_escort_nap1_fight
danger              = danger@val_escort_nap1_small
wounded             = wounded@val_escort_nap1
combat_ignore_cond  = {=check_fighting(407:408) -val_escort_combat}

;--------------------------------------------------------------------------
; бой с гвардами
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_fight]
anim                = guard
meet                = meet@val_escort_nap1_ignore
on_info             = {+val_escort_guard1_dead +val_escort_guard2_dead} remark1@val_escort_nap1_task_done
wounded             = wounded@val_escort_nap1

;--------------------------------------------------------------------------
; гварды убиты
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_task_done]
no_move             = true
no_rotate           = true
anim                = guard
meet                = meet@val_escort_nap1_ignore
on_info             = {-val_escort_captive_dead} remark1@val_escort_nap1_captive_live, follower1@val_escort_nap1_captive_dead
wounded             = wounded@val_escort_nap1

;--------------------------------------------------------------------------
; заложник жив. проверяем помог ли актер
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_captive_live]
no_move             = true
no_rotate           = true
anim                = guard
meet                = meet@val_escort_nap1_ignore
on_info             = {+val_escort_actor_helped} remark1@val_escort_nap1_captive_live_helped, remark1@val_escort_nap1_captive_live_not_helped
wounded             = wounded@val_escort_nap1

;--------------------------------------------------------------------------
; актер помог. ждем пока подойдет заложник и поблагодарит напарника
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_captive_live_helped]
no_move             = true
;no_rotate           = true
target              = 400
anim                = guard
meet                = meet@val_escort_nap1_ignore
on_info             = {+val_escort_captive_phrase1_end} remark1@val_escort_nap1_phrase9
wounded             = wounded@val_escort_nap1

;--------------------------------------------------------------------------
; фраза: Это вот сталкера благодари. Он мне помог.
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_phrase9]
no_move             = true
;no_rotate          = true
target              = 400
anim                = guard
snd                 = val_escort_nap1_phrase5
meet                = meet@val_escort_nap1_ignore
on_signal           = sound_end | remark1@val_escort_nap1_wait_to_talk_phrase %+val_escort_nap1_phrase1_end%
wounded             = wounded@val_escort_nap1

;--------------------------------------------------------------------------
; актер не помог. ждем пока подойдет заложник и поблагодарит напарника
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_captive_live_not_helped]
no_move             = true
;no_rotate           = true
target              = 400
anim                = guard
meet                = meet@val_escort_nap1_ignore
on_info             = {+val_escort_captive_phrase1_end} remark1@val_escort_nap1_phrase11
wounded             = wounded@val_escort_nap1

;--------------------------------------------------------------------------
; фраза: Жив-здоров? Тогда возвращаемся на Базу за подмогой.
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_phrase11]
no_move             = true
;no_rotate           = true
target              = 400
anim                = guard
snd                 = val_escort_nap1_go_home
meet                = meet@val_escort_nap1_ignore
on_signal           = sound_end | patrol@val_escort_nap1_leave %+val_escort_nap1_phrase2_end%
wounded             = wounded@val_escort_nap1

;--------------------------------------------------------------------------
; заложник мертв. подходим к нему
;--------------------------------------------------------------------------
[follower1@val_escort_nap1_captive_dead]
leader              = 400
anim                = guard
meet                = meet@val_escort_nap1_ignore
stub_for_corpse     = true
distance            = 2
on_signal           = leader_dead | remark1@val_escort_nap1_phrase10
on_info             = {=distance_to_obj_le(400:3)} remark1@val_escort_nap1_phrase10
danger              = danger@val_escort_nap1_1
wounded             = wounded@val_escort_nap1

;--------------------------------------------------------------------------
; фраза: Черт подери!!!...Эх-ххх...Пусть земля тебе будет пухом, дружище.
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_phrase10]
no_move             = true
no_rotate           = true
;target              = 400
anim                = guard
snd                 = val_escort_dead
meet                = meet@val_escort_nap1_ignore
on_signal           = sound_end | {+val_escort_actor_helped} remark1@val_escort_nap1_wait_to_talk_phrase, patrol@val_escort_nap1_leave
on_timer            = 20000 | {+val_escort_actor_helped} remark1@val_escort_nap1_wait_to_talk_phrase, patrol@val_escort_nap1_leave
wounded             = wounded@val_escort_nap1

;--------------------------------------------------------------------------
; фраза: Подходи пообщаемся.
;--------------------------------------------------------------------------
[remark1@val_escort_nap1_wait_to_talk_phrase]
no_move                 = true
;no_rotate               = true
anim                    = guard
snd                     = val_escort_phrase_invite
meet                    = meet@val_escort_nap1_talk
;on_timer                = 60000 | patrol@val_escort_nap1_leave ; ждем минуту и уходим
on_actor_dist_ge_nvis   = 30 | patrol@val_escort_nap1_leave
wounded                 = wounded@val_escort_nap1

;--------------------------------------------------------------------------
; уходим с уровня
;--------------------------------------------------------------------------
[patrol@val_escort_nap1_leave]
path_walk               = leave_walk
path_look               = leave_look
formation               = line
commander               = true
meet                    = meet@val_escort_nap1_talk
on_signal               = arrived | %+val_escort_scene_end%
