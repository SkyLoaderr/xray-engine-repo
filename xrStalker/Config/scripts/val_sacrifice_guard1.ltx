[logic]
active = camper@wait
on_combat = combat
on_death = death
on_hit = hit
combat_ignore = combat_ignore

[combat]
on_info = {=see_actor} camper@kill %+val_sacrifice_plr_detected%

[death]
on_info = {=killed_by_actor} %+val_sacrifice_plr_detected%

[hit]
on_info = {=hit_by_actor} walker@leave %+val_sacrifice_plr_detected%

[combat_ignore]

;401 = "val_sacrifice_victim"
;403 = "val_sacrifice_bloodsucker"
;404 = "val_sacrifice_guard1"
;405 = "val_sacrifice_guard2"

; ждем пока игрок не зайдет в одну из стартовых зон
[camper@wait]
path_walk = val_sacrifice_guard1_walk 
path_look = val_sacrifice_guard1_look
def_state_campering = guard
def_state_campering_fire = guard_fire
def_state_moving = patrol
def_state_moving_fire = patrol_fire
on_info = {+val_sacrifice_start} remark@phrase1
on_info2 = {+val_sacrifice_plr_detected} camper@kill, {+val_sacrifice_victim_killed} walker@leave
combat_ignore_cond = {!see_actor}, {=check_fighting(403:401)}

; первая фраза. ждем на 2 фразы второго охранника
[remark@phrase1]
no_move = true
no_rotate = true
anim = guard
snd = speach
on_signal = sound_end | %+val_sacrifice_guard1_phrase1_done%
on_info = {+val_sacrifice_plr_detected} camper@kill, {+val_sacrifice_victim_killed} walker@leave
on_info2 = {+val_sacrifice_guard2_phrase12_done} remark@phrase2
combat_ignore_cond = {-val_sacrifice_victim_killed !see_actor}, {=check_fighting(403:401)}

; произносим вторую фразу, после чего переходим в схему убийства пленного
[remark@phrase2]
no_move = true
no_rotate = true
anim = guard
snd = speach
on_signal = sound_end | camper@kill
on_info = {+val_sacrifice_plr_detected} camper@kill, {+val_sacrifice_victim_killed} walker@leave
combat_ignore_cond = {-val_sacrifice_victim_killed !see_actor}, {=check_fighting(403:401)}

; убиваем пленного
[camper@kill]
radius = 0
path_walk = val_sacrifice_guard1_walk 
path_look = val_sacrifice_guard1_look
def_state_campering = guard
def_state_campering_fire = guard_fire
def_state_moving = patrol
def_state_moving_fire = patrol_fire
on_info = {+val_sacrifice_victim_killed -val_sacrifice_plr_detected} remark@phrase3, {+val_sacrifice_plr_detected} walker@leave
combat_ignore_cond = {=check_fighting(403)}

; завершающая фраза
[remark@phrase3]
no_move = true
no_rotate = true
anim = guard
snd = speach
on_signal = sound_end | walker@leave %+val_sacrifice_guard1_phrase3_done%
on_info = {+val_sacrifice_plr_detected} walker@leave
combat_ignore_cond = {=check_fighting(403)}

; уходим
[walker@leave]
path_walk = val_sacrifice_guard1_leave_walk 
path_look = val_sacrifice_guard1_leave_look
combat_ignore_cond = {=check_fighting(403)}
