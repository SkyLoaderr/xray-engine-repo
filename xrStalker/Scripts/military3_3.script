-- сталкер у шлагбаума

local anims = {"stoya_ruje_ 0", "vishka_3"}

function waiting (actor)
    military3_3.reset (actor)
	action (actor, move (move.standing, move.stand, move.line, patrol ("way_sh1")), 
			look (), anim (anims[math.random (1, table.getn (anims))]), cond (cond.anim_end))
	while actor:action () do wait () end
end

function reset (actor)
	actor:script (false, military3_3.script_name ())
	actor:script (true, military3_3.script_name ())
end

function moving (actor, path)
	military3_3.reset (actor)
	action (actor, move (move.standing, move.walk, move.line, patrol (path)),
			look (look.search), anim (anim.free), cond (cond.move_end))
--	printf ("Moving path - %s", path)
end

function main ()

	local stalker = get_level_object ("stalker_sh")

	stalker:script (true, military3_3.script_name ())

	--тут мы сидим и чистим ружжо :)

	action (stalker, move (move.standing, move.stand, move.line, patrol ("way_sh1")),
			look (), anim ("chistit ruje_1"), cond (cond.anim_end))

--    while stalker:action () do wait () end

--	military3_3.reset (stalker)
	action (stalker, move (move.standing, move.stand, move.line, patrol ("way_sh1")),
			look (), anim ("chistit ruje_1"), cond (cond.anim_end))

--    while stalker:action () do wait () end

--	military3_3.reset (stalker)
	action (stalker, move (move.standing, move.stand, move.line, patrol ("way_sh1")),
			look (), anim ("stul_podyem"), cond (cond.anim_end))

    while stalker:action () do wait () end

	local point = 1
	local nextpoint = 2
	
	military3_3.moving (stalker, "way_sh1")

	while true do
		  while stalker:action () do wait () end

		  military3_3.waiting (stalker)

		  point = nextpoint
--		  printf ("Next point : %d", nextpoint)	

		  --перемещения из точки 1
		  if point == 1 then
			 military3_3.moving (stalker, "way_sh1")
			 nextpoint = 2
			 end

		  --перемещения из точки 2
		  if point == 2 then
	     	 if math.random (1, 100) < 50 then
			    military3_3.moving (stalker, "way_sh2")
			    nextpoint = 3
			 else 
                military3_3.moving (stalker, "way_sh5")
		     	nextpoint = 4
			 end
		  end	

		  --перемещения из точки 3
		  if point == 3 then
			 if math.random (1, 100) < 50 then
				military3_3.moving (stalker, "way_sh3")
			    nextpoint = 4
			 else
				military3_3.moving (stalker, "way_sh4")
				nextpoint = 1
			 end
          end
 
		  --перемещения из точки 4
		  if point == 4 then
 			 military3_3.moving (stalker, "way_sh5")
			 nextpoint = 1
			 end
	end

	stalker:script (false, military3_3.script_name ())

end